# ADR-0003: sources/ 重複ファイルの扱い（削除禁止・正本明記）

- 日付: 2026-01-09
- 状態: 承認
- 影響Part: なし（sources/ は参照のみ）
- 参照: FACTS_LEDGER.md (F-0002), sources/README.md

## 背景

sources/生データ/ に以下のような重複ファイルが存在する：
- `VCG_VIBE_2026_MASTER_FINAL_20260109.md`（43,822行）
- `VCG_VIBE_2026_MASTER_FINAL_20260109 (1).md`（同内容、43,822行）
- 他にも ` (1)`, ` (2)`, ` (3)`, ` (4)` 付きファイルが多数

原因推定：ファイルアップロード時の重複。

この状況では以下の問題が生じる：
1. **どれが正本か不明**: 複数ファイルが存在すると、どれを参照すべきか迷う
2. **削除のリスク**: 誤って正本を削除すると、証拠能力が失われる
3. **検索の煩雑さ**: grep 等で検索すると、同じ内容が複数ヒットする

したがって、重複ファイルの扱いを明確にする必要がある。

## 決定

**sources/ の重複ファイルは「削除しない」**。代わりに、以下のルールで運用する：

### 1. sources/ は証拠能力維持のため「改変・削除禁止」
CLAUDE.md および ADR-0001 で確立したルールを厳守する：
- sources/ 内のファイルは **改変・上書き・削除禁止**（追記のみ許可）
- 理由: sources/ は「事実の記録」であり、後から手を加えると証拠能力が失われる

### 2. 正本（Canonical）を _MANIFEST_SOURCES.md に明記
sources/_MANIFEST_SOURCES.md に以下を追加：
- ファイル名
- SHA-256ハッシュ（重複検出用）
- 「正本」フラグ（Canonical: Yes/No）
- 由来・取得日・要旨

**例**:
```markdown
## files

### VCG_VIBE_2026_MASTER_FINAL_20260109.md
- SHA-256: `abc123...`
- Canonical: **Yes**（正本）
- 由来: 2026-01-09 に取得したマスタードキュメント
- 行数: 43,822行
- 要旨: VCG/VIBE 2026 運用マスター（最終版）

### VCG_VIBE_2026_MASTER_FINAL_20260109 (1).md
- SHA-256: `abc123...`（同一）
- Canonical: **No**（重複、参照しない）
- 由来: 上記の重複アップロード
```

### 3. 重複ファイルは「参照しない」扱い
- FACTS_LEDGER や docs/ からは、**正本のみを参照**する
- 重複ファイルは物理的に残すが、運用上は無視する

### 4. 今後の追加ルール
- sources/ に新ファイルを追加する際は、必ず _MANIFEST_SOURCES.md に記録
- SHA-256を計算し、既存ファイルと重複していないか確認
- 重複している場合は、追加せずに既存ファイルを正本として使用

## 選択肢

### 案A（採用）: 削除せず、_MANIFEST で正本明記
- **メリット**:
  - 証拠能力を維持（削除リスクゼロ）
  - 後から「なぜ重複したか」を追跡可能
  - ディスク容量が許す限り、安全
- **デメリット**:
  - ディスク容量を消費（ただし、テキストファイルなので軽微）

### 案B: 重複を削除
- **メリット**: ディスクが整理される
- **デメリット**:
  - **証拠能力喪失のリスク大**
  - sources/ は「改変・削除禁止」の原則に反する
  - 誤って正本を削除する可能性がある

### 案C: 重複を別フォルダ（_DUPLICATES/）へ移動
- **メリット**: sources/生データ/ がスッキリする
- **デメリット**:
  - 「移動」も一種の改変であり、原則に反する
  - 移動先を間違えるリスクがある

**結論**: 案A を採用。「削除しない」ことで証拠能力を維持し、_MANIFEST で正本を明記することで運用上の迷いを解消する。

## 影響範囲

### 互換/移行
- sources/_MANIFEST_SOURCES.md を更新し、正本を明記
- FACTS_LEDGER.md の「根拠: MASTER L###」は、正本ファイルを指すことを確認

### セキュリティ/権限
- sources/ は読取専用として扱う（Part09 で明記）
- 書き込み権限は HumanGate のみ（新規追加時）

### Verify/Evidence/Release への影響
- checks/ に「sources/ の改変検出」を追加することを推奨
  - 例: SHA-256の変更検出、ファイルのタイムスタンプ監視

## 実行計画

### 手順
1. ✅ 本ADR（0003）を追加（本ファイル）
2. 🔲 sources/_MANIFEST_SOURCES.md を更新（正本を明記）
3. 🔲 checks/ に「sources/ 改変検出」スクリプトを追加（任意）

### ロールバック
- 本ADRを廃止（状態: 廃止）
- 重複ファイルの扱いを再検討（ただし、削除は不可逆なので慎重に）

### 検証（Verify Gate）
- [ ] sources/_MANIFEST_SOURCES.md に全ファイルが記載されている
- [ ] 各ファイルに「Canonical: Yes/No」が明記されている
- [ ] 重複ファイルのSHA-256が一致している

## 結果
（後日記入: 運用開始後、重複ファイルの扱いに問題はなかったか）

---

## チェックリスト
- [x] ADR を decisions/ に配置
- [ ] sources/_MANIFEST_SOURCES.md を更新
- [ ] checks/ に sources/ 改変検出を追加（任意）

## 未決事項
- sources/ の保存期限（いつまで残す？）→ Part14 で定義予定
- 機密情報の扱い（sources/ に含めてよい？）→ Part09 で定義予定
- ディスク容量上限（何GBまで許容？）→ 環境依存、Part02 で方針明記

## 参照
- [sources/README.md](../sources/README.md) : sources/ の改変・削除禁止ルール
- [FACTS_LEDGER.md](../docs/FACTS_LEDGER.md) : F-0002（禁止事項）
- [CLAUDE.md](../CLAUDE.md) : sources/ の改変・削除禁止に関する絶対ルール
