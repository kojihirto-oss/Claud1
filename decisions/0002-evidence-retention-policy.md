# ADR-0002: Evidence Retention Policy（verify_reports保持ポリシー）

- 日付: 2026-01-11
- 状態: 承認
- 影響Part: Part10（Verify Gate）
- 参照: evidence/verify_reports/

## 背景

Verify Gate（Part10）で生成される verify_reports は監査証跡（Evidence）として保存される。
リポジトリの肥大化を防ぎつつ、監査・トレンド分析・回帰検出に必要な履歴を残す必要がある。

現状では保持ポリシーが未定義であり、以下のリスクがある：
- 無制限に蓄積するとリポジトリが肥大化
- 保持期間が短すぎると監査証跡・トレンド分析ができない
- 削除基準が不明確だと事故（重要な証跡の誤削除）が起きる

## 決定

**MUST**: verify_reports は **直近3件のみ** を保持する
**MUST**: 古い verify_reports を削除する際は、必ず git rm を使用し、コミット履歴に残す
**MUST**: 新しい verify_report 追加時、4件目以降は pruning 対象とする
**SHOULD**: pruning は手動実行とし、自動削除はしない（誤削除防止）

## 選択肢

### 1) 直近1件のみ保持
**メリット**:
- 最小限のストレージ
- シンプルで理解しやすい
- 常に最新状態のみにフォーカス

**デメリット**:
- 履歴比較不可（回帰検出できない）
- トレンド分析不可
- 監査証跡として不十分
- 最新レポートに問題がある場合、比較対象がない

### 2) 直近3件保持（採用）
**メリット**:
- トレンド分析可能（3回の推移を確認）
- 回帰検出可能（前回・前々回と比較）
- 監査証跡として十分
- デバッグ時に履歴参照可能
- ストレージ負荷は依然として小さい（markdown 3ファイル程度）

**デメリット**:
- pruning がやや複雑（最新3件を特定する必要）
- 1件保持より若干の容量増

### 3) 無制限保持（採用しない）
**理由**:
- リポジトリ肥大化
- 検索・管理が煩雑化
- SSOT原則（必要最小限の情報で運用）に反する

## 影響範囲

### 互換/移行
- 既存の verify_reports がある場合、pruning 手順で削減
- 削除は git rm で行うため、履歴には残る（復元可能）

### セキュリティ/権限
- Part09（Permission Tier）に従い、pruning は適切な権限で実行
- 自動削除は行わず、手動承認プロセスを維持

### Verify/Evidence/Release への影響
- **Verify**: 最新3件で十分な検証履歴を確保
- **Evidence**: 監査要件を満たす最小限の証跡を保持
- **Release**: リリース判定に必要な直近トレンドを参照可能

## 実行計画

### 手順
1. ADR-0002 を承認（本文書）
2. evidence/verify_reports/README.md を作成（保持ポリシー明記）
3. Part10 に保持ポリシーを追記（§ 9 監査観点）
4. pruning 手順書を作成（checks/ または evidence/verify_reports/）
5. 既存リポジトリに溜まっている古い verify_reports を pruning

### ロールバック
- git rm で削除したファイルは git log から復元可能
- ポリシー変更が必要な場合は新しいADRで上書き

### 検証（Verify Gate）
- evidence/verify_reports/ に最新3件のみ存在することを確認
- README.md に保持ポリシーが明記されていることを確認
- Part10 § 9 に参照パスが正しく記載されていることを確認

## 結果
（後日記入：運用開始後の学び・調整事項）
