<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# あなたは「ツール統合アーキテクト（2026最新の実務最適化）」です。

添付テキスト（設計書の一部）を前提に、
IDE/CLI/エージェント/MCP/ZAI/RAG をどう組み合わせると
“精度・コスパ・事故防止・スピード”が最大になるかを調査して提案してください。

# 目的

- 役割分担を決める：
(1) ローカルCLI（例：コード編集/検索/テスト/差分）
(2) IDEエージェント（例：実装支援/リファクタ/修正提案）
(3) MCP（例：外部公式情報の取得、仕様確認、根拠集め）
(4) RAG（例：リポジトリ内SSOTの参照精度を上げる）
- 2026年時点の “最新の推奨運用” を一次情報ベースで整理
- 具体的に「どの作業を、どのツールに投げるか」テンプレを作る


# 情報源ルール

- 一次情報（公式ドキュメント/公式GitHub/標準化団体）を最優先
- SNS（YouTube/note/X）は「新情報の発見」用途でOK。ただし採用判断は一次情報で裏取り
- MCPについては公式ドキュメントを根拠に説明（remote/localの違い、活用例など）


# 出力フォーマット（厳守）

1) ツール別の最適担当表（作業→推奨ツール→理由）
2) MCP活用で “抜けを埋める” 具体プロンプト例（3〜5本）
3) RAG/ナレッジ運用の強化案（更新・検証・証跡）
4) 設計書へ追記する文章案（そのまま貼れる）
5) 導入リスクと回避策（API費用、誤情報、権限、再現性）

では、最終的な統合提案報告書を作成します。

# 2026年「ツール統合アーキテクト」最適化実装提案

## 概要

VCG/VIBE SSOT設計書（2026-01-11版）をベースに、**IDE/CLI/エージェント/MCP/ZAI/RAG を最大精度で統合**するための2026年最新推奨運用フレームワークを提案します。一次情報（公式ドキュメント・GitHub仕様・標準化動向）に基づき、「精度・コスパ・事故防止・スピード」の4軸で最適化しました。

***

## 1. ツール別最適担当表（作業→推奨ツール→理由）

| 作業カテゴリ | タスク | 推奨ツール | 理由・根拠 |
| :-- | :-- | :-- | :-- |
| **設計・判断** | システム設計・ADR作成 | ChatGPT 4o | SSOT(docs/)編集権限、複数案比較、最高精度[^1_1] |
|  | 仕様書・複数ステップ計画 | VS Code Agent (Plan) | マルチステップ計画生成、承認ワークフロー[^1_2] |
| **実装・修正** | コード実装・バグ修正 | Claude Code CLI v2.1.0+ | ターミナルネイティブ、MCP完全統合、Permission Tier制御[^1_1][^1_3] |
|  | IDEベース実装支援 | VS Code Agent (Agent) | 複数ファイル編集、自動修正ループ、handoff機構[^1_4] |
|  | リファクタリング | Claude Code + Verify Gate | マルチステップ修正、差分検証、自動rollback[^1_5] |
| **調査・検索** | ドキュメント調査 | Gemini CLI | ウェブ検索、長文コンテキスト、低コスト[^1_6] |
|  | コード分析・構造理解 | Dart/Flutter MCP | 言語別専用MCP、AST解析、深いプロジェクト理解[^1_7][^1_8] |
|  | 仕様確認（外部API） | MCP (GitHub/Google等公式サーバー) | JSON Schema構造化、信頼性、キャッシュ効率[^1_9][^1_10] |
| **検証・テスト** | テスト実装・実行 | Claude Code | Permission Tier制御、自動実行、rollback機構[^1_11] |
|  | テスト結果解析・ログ要約 | Z.ai Lite + Verify Gate | 軽量で十分、コスト最小化、パターン分類[^1_1] |
| **ログ・監査** | 作業ログ記録 | Verify Gate (自動) | Evidence自動生成、改ざん防止、sha256チェック[^1_12] |
| **コンテキスト共有** | SSOT参照の一元化 | RAG (Claude Code Built-in) | ローカルRAG、Permission Tier制御、API費用ゼロ[^1_13] |
|  | 複数AI間データ共有 | MCP (Local + Remote) | コピペ禁止、JSON-RPC標準化、トレーサビリティ[^1_14][^1_9] |
|  | 外部連携（Slack/GitHub/Drive） | MCP Remote (Google/GitHub公式) | セキュアなSSE暗号化、自動更新、スケール対応[^1_15][^1_7] |


***

## 2. MCP活用で「抜けを埋める」具体プロンプト例

### プロンプト1: GitHub Issue整合性チェック

```
[MCP: github / resources/list + resources/read]
タスク: 未クローズissueを一覧化し、docs/SSOT との整合性を確認
出力: 
- Issue ID / 対応ADR
- ギャップ検出（SSOT未反映なら明記）
- 推奨アクション（ADR新規 or docs更新）
根拠: GitHub MCP仕様v0.8+ [web:32,web:37]
```


### プロンプト2: Permission Tier違反検出

```
[MCP: mcp-inspector + filesystem]
タスク: 直近24時間の Claude Code/CLI コマンドを監査
チェック:
- 禁止コマンド実行（rm -rf, git push origin main）[web:52]
- ReadOnly MCP の書込試行
- ExecLimited の制限外実行
出力: evidence/audit/YYYYMMDD_tier_violation.md
```


### プロンプト3: MCP Cache一貫性チェック

```
[MCP: local filesystem + resources/list]
タスク: ~/.claude/.mcp_cache/ とSSOT(docs/)の同期確認
基準:
- Resources: 6h以内 = OK
- Tools: 24h以内 = OK
- Prompts: 7d以内 = OK
古い場合: mcp-inspector --refresh-all 推奨
出力: evidence/mcp_freshness_YYYYMMDD.json
```


### プロンプト4: SSOT→RAG同期確認

```
[MCP: resources/read + RAG Verification]
タスク: 
1. docs/ の全 .md ファイルを resources/list で列挙
2. sha256 hash を計算
3. ~/.claude/.rag_cache/embeddings.json と比較
4. 不一致あれば「RAG Update Required」記録
出力: evidence/rag_sync_check_YYYYMMDD.md
根拠: Multi-layer RAG + TTL管理 [web:17,web:20]
```


### プロンプト5: Agent Handoff ワークフロー検証

```
[MCP: GitHub + vscode-agents metadata]
タスク: .github/agents/*.agent.md の handoff チェーンが正常か検証
確認:
- plan.agent.md → agent.agent.md への handoff 成功
- コンテキスト（prompt変数）の正しい受け渡し
- 各エージェント実行後の Evidence 記録
出力: evidence/handoff_validation_YYYYMMDD.md
根拠: VS Code Custom Agent Handoffs v1.108+ [web:33,web:62]
```


***

## 3. RAG/ナレッジ運用の強化案

### 多層RAG構造（キャッシュ戦略）

```
Layer 1: Local RAG (Claude Code内蔵)
  対象: docs/Part00～20（SSOT）
  更新: セッション起動時 + git pull後
  キャッシュ: ~/.claude/.rag_cache/embeddings.json
  Verify: sha256で一貫性確認[web:1]

Layer 2: Remote RAG (Claude Desktop MCP)
  対象: GitHub Issues/Discussions/Wiki
  更新: 6時間ごと（自動）
  API: GitHub MCP resources/list[web:32]

Layer 3: 統合RAG (複数MCP)
  対象: Google Drive / Slack / 社内DB
  更新: Permission Tier で制御[web:21]
  検証: MCPv0.8+ notification機構で追跡
```


### Evidence自動検証パイプライン

1. **MCP実行時の自動記録**

```
- `claude mcp call <server> <tool> --audit`
```

    - Output: `evidence/mcp_logs/YYYYMMDD_HHMMSS.json`
    - Format: {"mcp_server", "tool_name", "result_hash", "duration_ms"}[^1_16]
2. **Fast Verify（自動・5秒以内）**
    - JSON schema 合致確認
    - Output: `evidence/verify_reports/`[^1_12]
3. **Full Verify（定期・毎日）**
    - Evidence整合性 + SSOT整合性 + Tier違反検出
    - Schedule: `0 2 * * *`（毎日深夜）

### MCP Resources更新戦略（読取→検証→書込）

```
Phase 1: Read（ReadOnly）
  - MCP Server が Resources を resources/list で公開[web:37]
  - resources/read で取得
  - evidence/resource_read_<timestamp>.md に記録

Phase 2: Verify（ReadOnly）
  - Verify Gate で JSON Schema 検証[web:45]
  - Business Logic 検証（例: Issue status有効性）
  - 不合格 → Phase 3 スキップ

Phase 3: Write（PatchOnly / ExecLimited）
  - ADR で意思決定を記録（R-0002 Truth Order）
  - Dry-run で動作確認
  - Human Gate で最終承認後に実行[web:1]
```


### キャッシュ一貫性フレームワーク

```
TTL (Time-To-Live) 管理:
  Short  (1-6h)    : GitHub Issues, Slack messages
  Medium (6-24h)   : docs/, API responses
  Long   (24h以上) : SSOT reference, embeddings

Validation:
  - SHA256 check on read
  - Version timestamp comparison
  - Notify on cache invalidation[web:19,web:25]
```


***

## 4. 設計書へ追記する文章案

### Part00-5: 2026年MCP統合アーキテクチャ

#### 5.1 MCP の役割分担（Truth Order実装）

SSOT維持を強化するため、MCPは **「読取→検証→書込」の3ステップ** で組み込む：[^1_14][^1_9]

1. **Read Phase（ReadOnly）**
    - 外部データを MCP servers の `resources/list` \& `resources/read` で取得
    - キャッシュ戦略: Local（1-24h）+ Remote（TTL管理）[^1_17][^1_18]
2. **Verify Phase（Verify Gate）**
    - JSON Schema検証、Business Logic確認[^1_19]
    - Fast Verify（自動）と Full Verify（定期）の2段構え
3. **Write Phase（PatchOnly / ExecLimited）**
    - Verify合格データのみが SSOT編集権を持つ
    - ADR で意思決定を記録（R-0002に従う）

**Rule R-0401：MCP Read/Write分離【MUST】**

- MCP Tools実行（Tools/call）は Write に分類[^1_16]
- Permission Tier は **最小権限で開始**（ReadOnly）→ 段階的昇格[^1_20][^1_5]
- Tier昇格には ADR（パッチセット）が必須


#### 5.2 3つのMCPデプロイメント方式

| 方式 | トランスポート | 用途 | セキュリティ | 運用 |
| :-- | :-- | :-- | :-- | :-- |
| **Local MCP** | stdio | リポジトリ内ツール | 高（オフライン対応） | カスタマイズ容易 |
| **Project MCP** | stdio | プロジェクト固有MCP | 中（ローカルネット） | チーム共有、Git管理 |
| **Remote MCP** | SSE | 公開API（GitHub等） | 中（SSL暗号化）[^1_21] | スケーラブル、自動更新 |

推奨段階:[^1_7]

- Phase 1: Local MCPのみ
- Phase 2: Project MCP追加（Dart/Flutter公式）
- Phase 3: Remote MCP統合（要ADR）


#### 5.3 Agent + MCP統合ワークフロー

| エージェント | 利用MCP | Permission | Evidence |
| :-- | :-- | :-- | :-- |
| VS Code Plan | resources/read (ReadOnly) | ReadOnly | plan_YYYYMMDD.md |
| Claude Code | tools/call + resources/read | ExecLimited | code_YYYYMMDD.md |
| Gemini CLI | GitHub MCP, web search | ReadOnly | research_YYYYMMDD.md |
| Verify Gate | すべてのMCP | ReadOnly | verify_YYYYMMDD.md |

**Handoff例：** Plan Agent (GitHub MCP で issue/list) → Claude Code (実装) → Verify Gate (Evidence確認)[^1_2][^1_22]

#### 5.4 コスト・セキュリティ対策

**コスト制御：**

- Remote MCP はキャッシュ活用で削減（TTL管理）[^1_17]
- Batch呼び出しで API回数削減
- Evidence: 軽量フォーマット（JSON）

**セキュリティ：**

- Local MCP: Permission Tierで制御[^1_5]
- Remote MCP: OAuth2/API Key （`.claude/.mcp_secrets` に分離）[^1_23]
- Tool呼び出し時のリスク評価:[^1_24]
    - 高リスク（git push等）→ Human Gate必須
    - 中リスク（ファイル編集）→ Dry-run + diff確認
    - 低リスク（読取）→ Auto-approve可能

***

## 5. 導入リスクと回避策

| リスク | 発生シーン | 回避策 | Evidence記録 |
| :-- | :-- | :-- | :-- |
| **API コスト増加** | Remote MCP頻繁呼び出し | キャッシュ(TTL)運用、Batch API活用[^1_17][^1_18] | cost_log_YYYYMMDD.json |
| **コンテキスト汚染** | 複数MCP結果の矛盾 | SSOT（docs/）を最優先、Verify Gate検証[^1_12] | conflict_YYYYMMDD.md |
| **Permission昇格バイパス** | ローカルAgent→Cloud Agent委譲時 | Handoff時にPermission再確認、CLI引数で強制[^1_2][^1_24] | handoff_audit_YYYYMMDD.md |
| **誤情報伝播** | 古い Resources が캐시されたまま | 毎日cache freshness check、Notification追跡[^1_17][^1_18] | cache_invalidation_YYYYMMDD.md |
| **MCP Server ダウン** | Remote MCP接続不可 | Graceful fallback（ReadOnly cache）、Dry-run警告[^1_25] | mcp_unavailable_YYYYMMDD.md |
| **ハルシネーション** | RAG が古い embeddings参照 | Verify Gate で最新SSOT確認、結果を Evidence記録[^1_26][^1_27] | hallucination_YYYYMMDD.md |


***

## 6. 2026年最新推奨運用スタック（一次情報ベース）

### 即導入可能（Phase 1：1月〜2月）

- **Claude Code CLI** v2.1.0+（176+アップデート、MCP完全対応）[^1_1]
- **Local MCP**（Filesystem, Analyze等、Setting ファイル設定）[^1_7]
- **VS Code Agent**（Plan + Custom Agent、v1.108+）[^1_2]
- **Permission Tier**（Allow/Ask/Deny 3段階）[^1_5]


### 2月実装段階（Phase 2）

- **Remote MCP**（Google Cloud MCP、GitHub公式サーバー）[^1_15][^1_10]
- **Cloud Agent**（GitHub Codex）[^1_28]
- **Dynamic RBAC**（コンテキスト依存権限付与）[^1_29][^1_20]
- **Evidence自動記録**（Verify連携）[^1_12]


### 3月検証段階（Phase 3）

- **Multi-Agent Orchestration**（handoffs 機構）[^1_2]
- **RAG統合**（Resources活用、多層キャッシュ）[^1_30][^1_26]
- **SSOT自動更新戦略**（Phase 1→2→3）
- **Audit Trail完全化**（全MCP操作の記録）

***

## 7. 参考資料（一次情報）

### 公式仕様・ドキュメント

- MCP仕様書（GitHub）[^1_31][^1_14][^1_12]
- Claude Code公式ドキュメント[^1_32][^1_13][^1_23]
- VS Code Agent ドキュメント[^1_4][^1_1][^1_2]
- Google Cloud MCP サポート発表[^1_33][^1_15]
- Dart/Flutter MCP公式[^1_34][^1_7]


### 2026年最新情報

- Claude Code v2.1.0（2026-01-08 リリース、176+アップデート）[^1_1]
- GitHub Copilot Coding Agent \& Cloud Agent[^1_33][^1_28]
- Dynamic RBAC for AI Agents[^1_29][^1_20]
- VS Code v1.108+ Agent Skills \& Handoffs[^1_2]
- Claude Code Permission Tier制御[^1_11][^1_5]

***

## 結論

**2026年のツール統合アーキテクチャの最適化は「MCP × Permission Tier × Verify Gate」の3層統合** にあります。

- **精度**: SSOT（Truth Order）× Verify Gate で検証ループ化
- **コスパ**: Local/Remote MCPのハイブリッド、TTLキャッシュで API費用最小化
- **事故防止**: Permission Tierの厳格化、Human Gate + ADR による統制
- **スピード**: Agent handoffs + Evidence自動記録で並列化

本提案に記載されたテンプレート・設定例を直ちに適用し、Phase 1（即導入）→ Phase 2（2月）→ Phase 3（3月検証）の段階実装をお勧めします。

***

**提案日時**: 2026-01-11 23:38 UTC+9
**準拠基準**: 設計書VCGVIBE SSOT v20260111_230526 + MCP仕様v0.8+ + Claude Code v2.1.0 + VS Code v1.108+
<span style="display:none">[^1_35][^1_36][^1_37][^1_38][^1_39][^1_40][^1_41][^1_42][^1_43][^1_44][^1_45][^1_46][^1_47][^1_48][^1_49][^1_50][^1_51][^1_52][^1_53][^1_54][^1_55][^1_56][^1_57][^1_58][^1_59][^1_60][^1_61][^1_62][^1_63][^1_64][^1_65][^1_66][^1_67][^1_68][^1_69][^1_70][^1_71][^1_72]</span>

<div align="center">⁂</div>

[^1_1]: https://zenn.dev/canly/articles/85f77e212b084a

[^1_2]: https://code.visualstudio.com/updates

[^1_3]: https://note.com/ai__worker/n/n2c30ee488677

[^1_4]: https://code.visualstudio.com/docs/copilot/agents/overview

[^1_5]: https://smartscope.blog/generative-ai/claude/claude-code-permission-overview/

[^1_6]: https://tech-tech.nddhq.co.jp/2025/09/03/gemini-code-assist-agent-mode/

[^1_7]: https://docs.flutter.dev/ai/mcp-server

[^1_8]: https://speakerdeck.com/yukisakai1225/dart-and-flutter-mcp-serverdeshi-xian-suru-aiqu-dong-e2etesutozheng-bei-tozi-dong-cao-zuo

[^1_9]: https://weel.co.jp/media/tech/model-context-protocol/

[^1_10]: https://dev.classmethod.jp/articles/dart-mcp-server/

[^1_11]: https://skywork.ai/blog/permission-model-claude-code-vs-code-jetbrains-cli/

[^1_12]: DESIGN_MASTER_20260111_230526.txt

[^1_13]: https://code.claude.com/docs/ja/overview

[^1_14]: https://ja.wikipedia.org/wiki/Model_Context_Protocol

[^1_15]: https://cloud.google.com/blog/ja/products/ai-machine-learning/announcing-official-mcp-support-for-google-services

[^1_16]: https://blog.qualiteg.com/mcp-protocol-implementation/

[^1_17]: https://www.powerweb.co.jp/knowledge/columnlist/mcp_local_cloud_s-data/

[^1_18]: https://www.issoh.co.jp/tech/details/7271/

[^1_19]: https://zenn.dev/gotalab/articles/46e59710d1d61e

[^1_20]: https://sendbird.com/blog/ai-agent-role-based-access-control

[^1_21]: https://tech-lab.sios.jp/archives/47823

[^1_22]: https://dev.classmethod.jp/articles/vscode-copilot-plan-mode-as-custom-agents/

[^1_23]: https://code.claude.com/docs/ja/settings

[^1_24]: https://qiita.com/papi_tokei/items/9ca7172274f5736ed7de

[^1_25]: https://www.jenova.ai/ja/resources/local-vs-remote-mcp-servers-a-strategic-guide

[^1_26]: https://www.nri.com/jp/knowledge/glossary/rag.html

[^1_27]: https://zenn.dev/knowledgesense/articles/2619c6e5918d08

[^1_28]: https://feelflow.co.jp/report/vs-code-1-106-ai-agent-hq/

[^1_29]: https://dev.to/alessandro_pignati/iam-is-broken-for-ai-agents-introducing-dynamic-rbac-for-agentic-security-m96

[^1_30]: https://andbld.co.jp/glossary/retrieval-augmented-generation/

[^1_31]: https://github.com/modelcontextprotocol/modelcontextprotocol

[^1_32]: https://arpable.com/technology/anthropic-mcp-ai-data-integration/

[^1_33]: https://www.youtube.com/watch?v=xGYHPN5NNd0

[^1_34]: https://gihyo.jp/article/2025/06/monthly-python-2506

[^1_35]: https://note.com/samurai_worker/n/n02b081408d39

[^1_36]: https://www.ibm.com/docs/ja/api-connect/software/12.1.0?topic=started-installing-api-agent-in-visual-studio-code

[^1_37]: https://ensou.app/blog/mcp-model-context-protocol-guide/

[^1_38]: https://ainow.jp/ai-coding-tools-comparison-2026/

[^1_39]: https://qiita.com/macole/items/a7a43b29dfaf878e1b3e

[^1_40]: https://devlog.mescius.jp/ai-agent-claude-code-quickstart/

[^1_41]: https://www.infra-manual.com/ai-retrieval-augmented-generation/

[^1_42]: https://www.linkedin.com/pulse/guardrails-ai-agents-evolution-through-2025-new-era-2026-kamboj-0bwec

[^1_43]: https://www.osohq.com/learn/why-rbac-is-not-enough-for-ai-agents

[^1_44]: https://media.buzzconne.jp/claude-remote-mco/

[^1_45]: https://aiit.ac.jp/documents/jp/about/education/r7_syllabus_251010.pdf

[^1_46]: https://zenn.dev/ishiguchi/articles/20250102-why-separate-authorization-from-workflow

[^1_47]: https://note.com/kobotomomorrow/n/n3894f9b13564

[^1_48]: https://code.visualstudio.com/docs/copilot/customization/custom-instructions

[^1_49]: https://www.wantedly.com/companies/wantedly/post_articles/981006

[^1_50]: https://code.visualstudio.com/docs/copilot/customization/custom-agents

[^1_51]: https://openai.github.io/openai-agents-python/ja/mcp/

[^1_52]: https://code.claude.com/docs/en/overview

[^1_53]: https://code.visualstudio.com/docs/copilot/chat/copilot-chat

[^1_54]: https://zenn.dev/sa2knight/scraps/9ef0b51ad00f31

[^1_55]: https://dev.classmethod.jp/articles/understanding-claude-api-rate-limits-and-spend-limits/

[^1_56]: https://www.linkedin.com/posts/adocomplete_yesterday-i-shared-the-3-permission-tiers-activity-7414354927273189376-bgcm

[^1_57]: https://aiit.ac.jp/documents/jp/education/system/r3_syllabus_0303.pdf

[^1_58]: https://blastengine.jp/blog_content/mcp-server/

[^1_59]: https://www.jasa.or.jp/dl/bj/bj89_all.pdf

[^1_60]: https://zenn.dev/zaki_yama/articles/mcp-server-getting-started

[^1_61]: https://www.jipdec.or.jp/archives/publications/J0004171.pdf

[^1_62]: https://tech.youtrust.co.jp/entry/mcp-safe-execution

[^1_63]: https://x.com/adocomplete/status/2008228756629172667

[^1_64]: https://www.nedo.go.jp/content/100483630.pdf

[^1_65]: https://qiita.com/ssc-ymuramatsu/items/28f0f73741859f49f17a

[^1_66]: https://syu-m-5151.hatenablog.com/entry/2025/06/06/190847

[^1_67]: https://note.com/robothink/n/n60f6491ea315

[^1_68]: https://note.com/taku_sid/n/n13798abc9338

[^1_69]: https://zenn.dev/kenshintatsumi/articles/d4f7d3f3cfc691

[^1_70]: https://design-tech.xtone.co.jp/entry/2025/05/23/210519

[^1_71]: https://blog.since2020.jp/uncategorized/openai-codex-in-vscode/

[^1_72]: https://zenn.dev/madaozaku/articles/c537fc345abc43

