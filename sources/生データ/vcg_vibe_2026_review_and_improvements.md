# VCG/VIBE 2026 AI統合運用マスタードキュメント 厳格レビュー＆改善提案

**レビュー日**: 2026-01-09
**対象バージョン**: 2026-01-09（JST）
**評価基準**: 2026年最新のAI開発エコシステム、大規模バイブコーディングのベストプラクティス

---

## 総合評価

**現状スコア: B+（実用可能だが最適化余地あり）**

強み: Core4の役割分担思想、SSOTの徹底、ガードレールの設計
弱み: 2026年の最新機能・パラダイムへの対応不足、Antigravityの活用が表面的、並列実行戦略の欠如

---

## 1. 重大な欠落（即座に追加すべき項目）

### 1.1 Antigravity Manager Viewの活用が完全欠落

**問題**: ドキュメントはAntigravityを「IDE」としてのみ記載しているが、2026年のAntigravityの最大の革新は **Manager View（Agent Manager）** による並列エージェント実行。

**現状の記載**:
> Antigravity（IDE）: あなたの主IDE（Cursorの代替ではなく、中心）

**改善案**:
```
### Antigravity運用モード

1. **Editor View（同期モード）**
   - 用途: 単一ファイル編集、即座のインラインコマンド
   - 使用場面: 小規模修正、デバッグ、レビュー

2. **Manager View（非同期モード）★重要**
   - 用途: 複数エージェントの並列実行（最大8並列）
   - 使用場面: 
     - BUILD: 複数機能の同時実装
     - REPAIR: 複数バグの並列修正
     - TRIAGE: 複数調査タスクの同時実行
   
   - 運用ルール:
     - 各エージェントに独立したワークスペースを割当
     - Artifactベースの進捗確認（タスクリスト/スクリーンショット/実装計画）
     - マージ前に必ずVERIFY通過を確認

3. **Browser Subagent**
   - UIテストの自動実行
   - E2E検証のスクリーンショット取得
   - VERIFY工程の自動化に組込み
```

### 1.2 Claude Codeの「Explore → Plan → Code → Commit」ワークフローが未記載

**問題**: Claude Codeのベストプラクティスとして確立された「いきなりコードを書かせない」が反映されていない。

**現状の記載**:
```
BUILD（Claude Code Plus）
入力: SPEC.md + 関連ファイル最小 + 制約。
出力: 最小パッチ差分 / 影響範囲 / 追加・更新テスト / ロールバック手順。
```

**改善案**:
```
### 10.3 BUILD（Claude Code Plus）- 4段階実行

# STEP 1: EXPLORE（コード禁止）
入力: SPEC.md
指示: 「関連ファイルを読んで影響範囲を調査して。コードは絶対に書くな。」
出力: 関連ファイル一覧 / 依存関係 / 変更が必要な箇所

# STEP 2: PLAN（think hardモード）
指示: 「調査結果を基に実装計画を立てて。think hardで考えろ。」
出力: 実装計画.md（ファイル別の変更内容/順序/リスク）
→ 人間レビュー後、凍結

# STEP 3: CODE（TDD推奨）
指示: 「計画どおりに実装。テストを先に書いてから実装。」
出力: 最小パッチ / テストファイル / コミット

# STEP 4: COMMIT
指示: 「変更をコミットしてPR作成。CHANGELOGも更新。」
出力: コミット / PR / 更新ドキュメント
```

### 1.3 GLM-4.7のPreserved Thinkingモードが未活用

**問題**: Z.ai（GLM）を「安い手足」としてのみ扱っているが、GLM-4.7は長期タスクでの推論保持（Preserved Thinking）が強み。

**追加すべき内容**:
```
### 3.4 Z.ai Lite（GLM Coding Plan）- 拡張運用

**新機能: Preserved Thinking活用**
- 複数ターンにまたがるタスクで推論を維持
- 長時間のBUILD/REPAIRサイクルでコンテキスト喪失を防止
- Claude Codeの代替として使用可能な場面:
  - 中規模の反復修正
  - テンプレート適用の連続実行
  - ログ解析からの連続修正

**Turn-level Thinking制御**
- 軽量リクエスト: Thinking OFF（速度優先）
- 複雑タスク: Thinking ON（精度優先）
```

---

## 2. 構造的問題と改善

### 2.1 VIBEKANBANの工程間ハンドオフが曖昧

**問題**: 各工程の「入力/出力」が明確だが、**ツール間のファイル受渡し規約**がない。

**追加すべき内容**:
```
### 工程間ファイル規約（ハンドオフ標準）

| 工程 | 出力ファイル | 保存先 | 次工程への渡し方 |
|------|-------------|--------|-----------------|
| INBOX | ticket_{id}.md | VIBEKANBAN/inbox/ | → TRIAGE起動時に自動読込 |
| TRIAGE | triage_{id}.md | VIBEKANBAN/triage/ | SPEC.mdのリンク埋込 |
| SPEC | SPEC_{id}.md | VIBEKANBAN/spec/ | BUILD時のコンテキストとして必須 |
| BUILD | patch_{id}.diff | VIBEKANBAN/build/ | VERIFYの入力 |
| VERIFY | verify_{id}.json | VIBEKANBAN/verify/ | Green→RELEASE / Red→REPAIR |
| REPAIR | repair_{id}.diff | VIBEKANBAN/repair/ | → 再VERIFY |
| EVIDENCE | evidence_{id}.md | VAULT/evidence/ | KB登録 |
| RELEASE | manifest_{id}.json | VAULT/release/ | immutable |
```

### 2.2 並列実行戦略の完全欠落

**問題**: 個人開発でも「待ち時間」を減らすには並列実行が必須。現ドキュメントは全て逐次処理前提。

**追加すべきセクション**:
```
## 15. 並列実行戦略（スループット最大化）

### 15.1 並列化可能な工程

| 工程組合せ | 並列可否 | 実行方法 |
|-----------|---------|---------|
| TRIAGE × TRIAGE | ○ | Antigravity Manager View で複数エージェント |
| BUILD × BUILD | △ | 依存関係なければ可。ワークスペース分離必須 |
| BUILD × TRIAGE | ○ | 次チケットの調査を先行 |
| VERIFY × BUILD | ○ | 前チケットVERIFY中に次BUILDを開始 |
| REPAIR × REPAIR | × | 同一コードベースでの競合リスク |

### 15.2 推奨並列構成（個人開発）

同時実行上限: 3-4エージェント（認知負荷とのバランス）

**パイプライン例**:
```
時刻T:   [VERIFY: チケットA] + [BUILD: チケットB] + [TRIAGE: チケットC]
時刻T+1: [REPAIR: チケットA] + [VERIFY: チケットB] + [SPEC: チケットC]
```

### 15.3 Antigravity Manager View設定

Terminal Command Auto Execution: 許可リスト制
Agent並列数: 4（推奨）
ワークスペース分離: ブランチ単位
Artifact監視: タスクリスト＋スクリーンショット
```

---

## 3. セキュリティ強化（2026年必須項目）

### 3.1 AI生成コードのセキュリティスキャンが弱い

**現状の記載**:
> 静的解析・セキュリティ: Semgrep / Bandit 等でAI生成コードの安全性を機械判定

**問題**: 「任意」扱いだが、2026年の統計では**AI生成コードの45%にセキュリティ脆弱性**がある。

**改善案**:
```
### 7.5 セキュリティスキャン（必須）

**VERIFY工程に組込み（Greenの条件）**

1. 静的解析（必須）
   - Semgrep: カスタムルール + OWASP Top 10
   - Bandit（Python時）: 全警告をブロッカー扱い

2. 依存関係チェック（必須）
   - npm audit / pip-audit / cargo audit
   - CVSS 7.0以上は即ブロック

3. シークレットスキャン（必須）
   - gitleaks: コミット前フック
   - APIキー/トークンの誤混入防止

4. コードレビュー観点
   - AI生成コードは「信頼しない」前提
   - 特に: 入力検証 / 認証 / 暗号化処理

**CIパイプライン例**:
```yaml
verify:
  script:
    - semgrep --config=auto --error
    - npm audit --audit-level=high
    - gitleaks detect --source=.
```
```

### 3.2 Prompt Injection対策

**追加すべき内容**:
```
### 7.6 Prompt Injection防御

1. 外部入力のサニタイズ
   - ユーザー入力をAIに渡す前に正規化
   - 特殊文字・制御文字の除去

2. 権限分離
   - AIエージェントには最小権限のみ付与
   - データベース接続は読取専用を基本

3. 出力検証
   - AI生成コマンドを実行前に人間確認
   - 特に: rm / curl / wget / chmod 系
```

---

## 4. コンテキスト工学の強化

### 4.1 CLAUDE.mdファイルの標準化が未記載

**問題**: Claude Codeのベストプラクティスとして「CLAUDE.md」によるプロジェクト固有コンテキストの注入が確立されているが、ドキュメントに記載なし。

**追加すべき内容**:
```
### 8.4 CLAUDE.md標準テンプレート

プロジェクトルートに配置。Claude Code起動時に自動読込。

```markdown
# プロジェクト概要
[1-2文でプロジェクトの目的]

# 技術スタック
- 言語: 
- フレームワーク: 
- データベース: 

# コマンド
- ビルド: `npm run build`
- テスト: `npm test`
- リント: `npm run lint`

# コードスタイル
- インポート: ES Modules (import/export)
- フォーマット: Prettier適用済
- 命名規則: camelCase（変数）/ PascalCase（クラス）

# 禁止事項
- console.log() のコミット
- any型の使用（TypeScript）
- 直接的なDOM操作

# 重要ファイル
- 設定: config/settings.ts
- ルーティング: src/routes/
- 共通ユーティリティ: src/utils/

# 既知の注意点
- [プロジェクト固有の落とし穴]
```
```

### 4.2 コンテキスト圧縮戦略

**追加すべき内容**:
```
### 8.5 長期セッション管理

**Claude Code /compact コマンド活用**
- 128Kトークン超過前に自動要約
- 重要コンテキストを保持しつつ圧縮

**手動トリガー条件**:
- 5回以上の修正サイクル
- エラーメッセージの繰返し
- 「忘れた」「理解できない」系のレスポンス

**圧縮時の保持優先順位**:
1. SPEC.md（常に保持）
2. 直近の失敗ログ
3. 現在の差分
4. 過去の修正履歴（圧縮対象）
```

---

## 5. プロンプトテンプレートの強化

### 5.1 現状のテンプレートは「弱い」

**問題**: 現在のプロンプトは短すぎて、AIの解釈余地が大きすぎる。

**改善例（BUILD）**:
```
### 10.3 BUILD（Claude Code Plus）- 強化版

```markdown
## コンテキスト
- 添付: SPEC.md（凍結済み仕様）
- 添付: 関連ファイル一覧
- ブランチ: feature/{ticket_id}

## 実行ステップ

### Step 1: 調査（コード生成禁止）
以下を調査し報告せよ：
1. SPEC.mdの要件一覧（箇条書き）
2. 影響を受けるファイル（パス一覧）
3. 変更が必要な関数/クラス
4. 既存テストへの影響
5. リスク（高/中/低で評価）

この時点でコードを書くな。「調査完了」と報告せよ。

### Step 2: 計画（承認待ち）
調査結果を基に実装計画を作成：
- ファイル別の変更内容
- 変更順序（依存関係を考慮）
- 追加するテストケース
- ロールバック手順

計画を提示し、「承認しますか？」と確認せよ。

### Step 3: 実装（承認後のみ）
承認を得てから：
1. テストを先に書く（TDD）
2. 最小差分で実装
3. リント/フォーマット適用
4. 変更点をコミットメッセージ形式で報告

### 禁止事項（違反即停止）
- 全域リライト
- 依頼外のファイル変更
- rm / 破壊コマンド
- テスト無しでのコミット
```
```

### 5.2 失敗パターンの事前注入

**追加すべき内容**:
```
### 10.7 失敗回避プロンプト（共通接頭辞）

すべてのプロンプトの冒頭に付与：

```
## 絶対禁止（これらをやったら即停止）
- 勝手な判断での大規模変更
- 「こうした方が良い」という改善提案の実行
- 指示範囲外のファイル変更
- エラー時の自動リトライ（報告せよ）

## 期待する行動
- 不明点は実行前に質問
- 複数の選択肢がある場合は提示
- 各ステップ完了時に報告
- エラー発生時は即座に停止して報告
```
```

---

## 6. Antigravity固有設定

### 6.1 権限設定が未記載

**追加すべき内容**:
```
### Antigravity セキュリティ設定

**Terminal Command Auto Execution ポリシー**

1. 推奨設定: 許可リスト（Allow List）方式

許可コマンド:
- npm / yarn / pnpm（パッケージ管理）
- git status / git diff / git log（読取系）
- ls / cat / head / tail（ファイル確認）
- make / cargo build / go build（ビルド）

要承認コマンド:
- git commit / git push（変更確定）
- npm publish（公開）

拒否コマンド:
- rm / rmdir（削除系）
- chmod / chown（権限変更）
- curl / wget + 実行（外部スクリプト）
- sudo *（特権昇格）

2. ブラウザ権限
- localhost のみ自動許可
- 外部URLは都度承認
```

---

## 7. 測定と改善サイクル

### 7.1 KPIが未定義

**追加すべきセクション**:
```
## 16. 運用KPIと改善サイクル

### 16.1 トラッキング指標

| 指標 | 目標 | 測定方法 |
|------|------|---------|
| SPEC→BUILD成功率 | >80% | 初回VERIFYでGreen |
| REPAIRサイクル数 | <3回 | Green到達までの修正回数 |
| チケット完了時間 | - | INBOX→RELEASEの経過時間 |
| セキュリティ違反 | 0 | スキャンでのCritical検出 |
| コンテキスト破綻 | <10% | 圧縮/リセットが必要になった率 |

### 16.2 週次レトロスペクティブ

毎週チェック：
1. 最も時間がかかった工程は？
2. 繰返し発生したエラーパターンは？
3. プロンプトの改善点は？
4. ツール間連携の摩擦は？

### 16.3 プロンプト改善サイクル

失敗パターン発見
→ 原因分析（プロンプト不足 or ツール問題）
→ テンプレート修正
→ 次回検証
→ 効果測定
```

---

## 8. 追加すべきセクション

### 8.1 エラーハンドリング戦略

```
## 17. エラーハンドリング標準

### 17.1 エラー分類と対応

| エラー種別 | 対応 | 担当 |
|-----------|------|------|
| 構文エラー | 即修正 | Claude Code |
| テスト失敗 | REPAIR工程 | Claude Code |
| 型エラー | 即修正 | Claude Code |
| ランタイムエラー | ログ解析→修正 | Z.ai→Claude Code |
| セキュリティ警告 | 人間判断 | 開発者 |
| 依存関係衝突 | 調査→修正 | Gemini→Claude Code |

### 17.2 エスカレーションルール

1. 同一エラー3回連続 → モデル切替（GLM→Claude）
2. 5回以上のREPAIR → 人間介入＋SPEC見直し
3. セキュリティ関連 → 即座に人間判断
```

### 8.2 バックアップとリカバリ

```
## 18. 障害復旧計画

### 18.1 自動バックアップ

- 各BUILD前: ブランチスナップショット
- 各VERIFY前: ワークスペース状態保存
- 日次: VAULT全体のtar.gz

### 18.2 リカバリ手順

| 状況 | 復旧方法 |
|------|---------|
| BUILD失敗 | git reset --hard HEAD~1 |
| VAULT破損 | 日次バックアップから復元 |
| コンテキスト破綻 | セッションリセット＋SPEC再読込 |
| ツール障害 | 代替ツールへフェイルオーバー |

### 18.3 フェイルオーバー順序

Claude Code障害時:
1. Antigravity内蔵エージェント（Gemini 3）
2. Z.ai GLM-4.7（Preserved Thinking有効）
3. ローカルLLM（Ollama）
```

---

## 9. 優先度付き改善ロードマップ

### P0（即座に実施）

1. **Antigravity Manager View活用ルールの追加**
2. **Claude Code 4段階ワークフロー（Explore→Plan→Code→Commit）の導入**
3. **セキュリティスキャンのVERIFY必須化**
4. **CLAUDE.mdテンプレートの標準化**

### P1（1週間以内）

5. 工程間ハンドオフ規約の策定
6. 並列実行戦略の追加
7. 強化版プロンプトテンプレートの適用
8. KPIトラッキングの開始

### P2（2週間以内）

9. エラーハンドリング戦略の実装
10. バックアップ/リカバリ計画の実装
11. GLM-4.7 Preserved Thinking活用の検証
12. 週次レトロスペクティブの開始

---

## 10. 現ドキュメントとの差分サマリ

| 項目 | 現状 | 改善後 |
|------|------|--------|
| Antigravity活用 | IDE機能のみ | Manager View並列実行 |
| Claude Codeワークフロー | 単発BUILD | 4段階（Explore→Plan→Code→Commit） |
| セキュリティ | 任意扱い | VERIFY必須条件 |
| 並列実行 | 未記載 | 3-4エージェント並列戦略 |
| コンテキスト管理 | 基本のみ | CLAUDE.md＋圧縮戦略 |
| プロンプト | 簡易版 | 失敗回避付き強化版 |
| GLM活用 | 整形/要約 | Preserved Thinking追加 |
| KPI | 未定義 | 5指標＋週次レトロ |
| エラー対応 | 暗黙 | 分類＋エスカレールール |
| 障害復旧 | 未記載 | バックアップ＋フェイルオーバー |

---

## 結論

現ドキュメントは**堅実な基盤**を持つが、2026年のAI開発エコシステムの進化（特にAntigravityのエージェント並列実行、Claude Codeの構造化ワークフロー、GLM-4.7の長期推論保持）を取り込むことで、**開発スループットを2-3倍向上**させる余地がある。

最優先は**P0の4項目**の即時実装。これにより「直感的に高精度の開発」が実現可能になる。
